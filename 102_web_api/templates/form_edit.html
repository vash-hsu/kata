<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Manipulation</title>
  <script src="/static/script/jquery-3.1.1.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/bootstrap.css">
</head>

<body>

<!-- template generated by http://bootsnipp.com/forms?version=3 -->

<form class="form-horizontal">
<fieldset>

<!-- Form Name -->
<legend>manipulator</legend>

<!-- Multiple Radios (inline) -->
<div class="form-group">
  <label class="col-md-4 control-label" for="radios">options</label>
  <div class="col-md-4">
    <label class="radio-inline" for="radios-1">
      <input name="radios" id="radios-1" value="'update'" type="radio" checked="checked">
      put/update
    </label>
    <label class="radio-inline" for="radios-2">
      <input name="radios" id="radios-2" value="'delete'" type="radio">
      delete
    </label>
  </div>
</div>

<!-- Textarea -->
<div class="form-group">
  <label class="col-md-4 control-label" for="json_input">JSON</label>
  <div class="col-md-4">
    <textarea class="form-control" id="json_input" name="json_input">{'name': 'value'}</textarea>
  </div>
</div>

<!-- Button (Double) -->
<div class="form-group" onsubmit="return false">
  <label class="col-md-4 control-label" for="button2confirm">action</label>
  <div class="col-md-8">
    <button id="button2confirm" name="button2confirm" class="btn btn-success">Confirm</button>
    <button id="button2cancel" name="button2cancel" class="btn btn-danger">Cancel</button>
  </div>
</div>

</fieldset>
</form>


<script>

var resource_url = "{{ resource_url }}";
var action_type = "{{ action_type }}";
var resource_id = "{{ resource_id }}";

function update_text_field(json_object)
{
  // console.log(raw_data);
  // alert("server return status = ".concat(json_object.status))
  document.getElementById("json_input").value = JSON.stringify(json_object.value);
  document.getElementById("button2confirm").disabled = false;
}

function retrieve_json(_base_url, _id)
{
  var target_url = _base_url.concat("/", _id);
  jQuery.ajax({
    url: target_url,
    type: "GET",
    contentType: 'application/json; charset=utf-8',
    success: function(resultData){
      update_text_field(resultData);
    },
    error: function(jqXHR, textStatus, errorThrown){
    },
    timeout: 10000,
  });
}

function post_json(_url, _id, user_input)
{
  // alert(_base_url);
  // alert(_id);
  // alert(user_input);

  var target_url = _url.concat("/", _id);
    jQuery.ajax({
      url: target_url,
      type: "PUT",
      data: user_input,
      contentType: 'application/json; charset=utf-8',
      success: function(resultData){
        // alert('server return status = '.concat(resultData.status));
        if (parseInt(resultData.status) < 0)
        {
          alert('server return reason = '.concat(resultData.reason.toString()))
        }
        else
        {
          alert('Successfully to update resource '.concat(_id));
        }
      },
      error: function(jqXHR, textStatus, errorThrown){
      },
      timeout: 10000,
    });

}

function click_submit()
{
  user_inpu = document.getElementById("json_input").value;
  post_json(resource_url, resource_id, user_inpu);
}

document.getElementById("button2confirm").disabled = true;
// http://stackoverflow.com/questions/14938290/how-to-avoid-refreshing-the-page-in-a-bootstrap-modal
$("#button2confirm").on("click", function(e) {
    e.preventDefault();
    click_submit();
});
$("#button2cancel").on("click", function(e) {
    e.preventDefault();
    location.reload();
});

retrieve_json(resource_url, resource_id);

</script>


</body>
</html>
