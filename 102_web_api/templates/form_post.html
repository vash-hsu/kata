<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>console for POST/New</title>
  <script src="/static/script/jquery-3.1.1.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/bootstrap.css">
</head>

<body>

<!-- template generated by http://bootsnipp.com/forms?version=3 -->

<div class="container">
<form class="form-horizontal">
<fieldset>

<!-- Form Name -->
<legend>new creation</legend>


<!-- Textarea -->
<div class="form-group">
  <label class="col-md-4 control-label" for="json_input">JSON</label>
  <div class="col-md-4">
    <textarea class="form-control"
    id="json_input" name="JSON Input"
    rows="6"
    >{ "title": "hello world",
  "name": "window",
  "width": 800,
  "height": 600
}</textarea>
  </div>
</div>

<!-- Button (Double) -->
<div class="form-group">
  <label class="col-md-4 control-label" for="button1id">Upload</label>
  <div class="col-md-8">
    <button id="button2post" name="button2post" class="btn btn-success">Post</button>
    <button id="button2cancel" name="button2cancel" class="btn btn-danger">Reset</button>
  </div>
</div>

</fieldset>
</form>
</div>

<script>

var resource_url = "{{ resource_url }}";
var referer_url = "{{ referer_url }}";

function post_json(_url, user_input)
{
  jQuery.ajax({
    url: _url,
    type: "POST",
    data: user_input,
    contentType: 'application/json; charset=utf-8',
    success: function(resultData) {
      if (parseInt(resultData.status) < 0)
      {
        alert('server return reason = '.concat(resultData.reason.toString()))
      }
      else
      {
        var resource_id = resultData.value;
        alert('Successfully to update resource '.concat(resource_id));
        if (referer_url.length == 0) // close current tab
        {
          window.top.close();
        }
        else
        {
          window.location.href = referer_url;
        }
      }
    },
    error: function(jqXHR, textStatus, errorThrown){
    },
    timeout: 10000,
  });
}

function click_submit()
{
  var user_inpu = document.getElementById("json_input").value;
  post_json(resource_url, user_inpu);
}

// turn off default submit behavior
// http://stackoverflow.com/questions/14938290/how-to-avoid-refreshing-the-page-in-a-bootstrap-modal
$("#button2post").on("click", function(e) {
    e.preventDefault();
    click_submit();
});
$("#button2cancel").on("click", function(e) {
    e.preventDefault();
    location.reload();
});

</script>


</body>
</html>
